你好，我是许令波，花名“君山”。说起来我的职业生涯算是比较简单，2009年大学毕业后就进入了淘宝，一直工作了七年多。这七年多的时间里，我有幸看到了淘宝业务的快速增长，并且以开发者的身份参与其中。

说实话，作为一名程序员，我的技术能力也在公司业务的快速增长过程中得到了历练，并积累了一些大流量高并发网站架构设计和优化的经验，尤其是针对“秒杀”这个场景。因为我确信，那个时候我们肯定是对系统做了足够多的极致优化，才能扛住当时洪峰般的流量请求。

记得早期的时候，淘宝商品详情系统的PV还差不多是1亿的样子，但是到2016年差不多已经升至50亿了。尤其是2012年到2014年那个时间段，“秒杀”活动特别流行，用户的参与热情一浪高过一浪，系统要面对的流量也是成倍增长。

而每一次的秒杀活动对技术团队来说都是一次考验。现在想起来，那个时候我们整个团队，无所畏惧，逐步迭代创新，然后解决一个个难题的过程，也是极具挑战性和成就感的事情。

记得有一年，为了应对“双十一”，我们整个商品详情团队对系统做了很多优化，我们自认为已经是整个公司最牛的系统了，性能也已经是“业界之巅”。

但是那年“双十一”的晚上，我们的系统还是遇到了瓶颈。当时老大就跑过来盯着我们，问我们什么时候能够恢复，我们整个团队都承担着巨大的心理压力。

事后我们复盘宕机的原因，发现当时的秒杀流量远远超过了我们的预想，我们根本没想到大家的参与热情能有那么高。于是我们按照这个增长率去预估下一年的流量和服务器，粗算下来，我记得差不多要增加2000台服务器，简直不可思议。

怎么可能真正增加这么多机器，所以这也就倒逼我们必须找出一些特殊的手段来优化系统。后面，经过一段时间的调研和分析，我们想到了把整个系统进行动静分离改造的解决方案。

秒杀系统也差不多那个时候才从商品详情系统独立出来成为一个独立产品的。因为我见证了秒杀系统的建设过程，所以也有颇多感慨。秒杀系统的迭代又是一个升级打怪的过程，我们也都是遇到问题解决问题，逐一优化。

那么，如何才能更好地理解秒杀系统呢？我觉得作为一个程序员，你首先需要从高维度出发，从整体上思考问题。在我看来，**秒杀其实主要解决两个问题，一个是并发读，一个是并发写**。并发读的核心优化理念是尽量减少用户到服务端来“读”数据，或者让他们读更少的数据；并发写的处理原则也一样，它要求我们在数据库层面独立出来一个库，做特殊的处理。另外，我们还要针对秒杀系统做一些保护，针对意料之外的情况设计兜底方案，以防止最坏的情况发生。

而从一个架构师的角度来看，要想打造并维护一个超大流量并发读写、高性能、高可用的系统，在整个用户请求路径上从浏览器到服务端我们要遵循几个原则，就是要保证用户请求的数据尽量少、请求数尽量少、路径尽量短、依赖尽量少，并且不要有单点。这些关键点我会在后面的文章里重点讲解。

**其实，秒杀的整体架构可以概括为“稳、准、快”几个关键字。**

所谓“稳”，就是整个系统架构要满足高可用，流量符合预期时肯定要稳定，就是超出预期时也同样不能掉链子，你要保证秒杀活动顺利完成，即秒杀商品顺利地卖出去，这个是最基本的前提。

然后就是“准”，就是秒杀10台iPhone，那就只能成交10台，多一台少一台都不行。一旦库存不对，那平台就要承担损失，所以“准”就是要求保证数据的一致性。

最后再看“快”，“快”其实很好理解，它就是说系统的性能要足够高，否则你怎么支撑这么大的流量呢？不光是服务端要做极致的性能优化，而且在整个请求链路上都要做协同的优化，每个地方快一点，整个系统就完美了。

所以从技术角度上看“稳、准、快”，就对应了我们架构上的高可用、一致性和高性能的要求，我们的专栏也将主要围绕这几个方面来展开，具体如下。

- **高性能。** 秒杀涉及大量的并发读和并发写，因此支持高并发访问这点非常关键。本专栏将从设计数据的动静分离方案、热点的发现与隔离、请求的削峰与分层过滤、服务端的极致优化这4个方面重点介绍。
- **一致性。** 秒杀中商品减库存的实现方式同样关键。可想而知，有限数量的商品在同一时刻被很多倍的请求同时来减库存，减库存又分为“拍下减库存”“付款减库存”以及预扣等几种，在大并发更新的过程中都要保证数据的准确性，其难度可想而知。因此，我将用一篇文章来专门讲解如何设计秒杀减库存方案。
- **高可用。** 虽然我介绍了很多极致的优化思路，但现实中总难免出现一些我们考虑不到的情况，所以要保证系统的高可用和正确性，我们还要设计一个PlanB来兜底，以便在最坏情况发生时仍然能够从容应对。专栏的最后，我将带你思考可以从哪些环节来设计兜底方案。

最后，很幸运能在极客时间遇到你，希望这堂课能让你彻底理解大并发、高性能、高可用秒杀系统的设计之道，并能够在思考解决类似问题时有更准确的思考和判断。
<div><strong>精选留言（15）</strong></div><ul>
<li><span>小盖</span> 👍（41） 💬（0）<p>一共7篇，10月1日正式更新，每天一篇。详细的介绍大家可以在专栏简介页面了解。</p>2018-09-26</li><br/><li><span>chon</span> 👍（32） 💬（2）<p>建议增加如何用啥样的工具发现某个地方存在瓶颈。很多人不知道如何定位，即使学了，也不知道如何发现，定位和量化自己项目中问题</p>2018-09-28</li><br/><li><span>彭正聪</span> 👍（10） 💬（2）<p>问一个问题，存不存在2个请求完全同时的情况。这样先后顺序怎么区分?</p>2018-10-23</li><br/><li><span>long.mr</span> 👍（8） 💬（2）<p>问一哈，秒杀系统，判断先后顺序的依据是请求到达的时间戳吗？ 会不会有一个服务器存在串行的请求的情况，这样的话会在一定程度上影响公平性吗？</p>2018-09-25</li><br/><li><span>云学</span> 👍（7） 💬（1）<p>如何发现瓶颈点，怎么判断某个地方是否有优化的空间，有哪些推荐的工具，请作者分享一下</p>2018-09-29</li><br/><li><span>ds.Yang™️</span> 👍（6） 💬（1）<p>相见恨晚，最近也在读许老师的web技术内幕，很不错</p>2018-09-26</li><br/><li><span>倪</span> 👍（2） 💬（1）<p>lua.脚本操作redis秒杀，后同步数据库</p>2018-10-09</li><br/><li><span>过河卒子</span> 👍（2） 💬（1）<p>怎么没有看到具体课程介绍呀！</p>2018-09-27</li><br/><li><span>Geek_58ezrw</span> 👍（1） 💬（1）<p>@null

5秒一个请求，写太长了吧，体验太差了。
我以前做的秒杀是静态资源用阿里云的cdn,用redis计数限流。库存也是用redis的hash结构来存储，进行库存的减操作。效果也不是很好，压力也在redis这边。</p>2018-10-07</li><br/><li><span>罗</span> 👍（1） 💬（1）<p>居然不是开了 是开场白啊，还是点个赞吧！</p>2018-09-26</li><br/><li><span>追云的帆</span> 👍（1） 💬（1）<p>君山 老师写的书和文章一定要好好看看</p>2018-09-26</li><br/><li><span>朱晓磊</span> 👍（1） 💬（1）<p>记得第一次实习面试的时候，小组讨论就是关于 秒杀的问题 </p>2018-09-25</li><br/><li><span>Hidden</span> 👍（1） 💬（1）<p>面试官经常问 如何设计一个秒杀系统，不知从哪些角度 回答，一脸懵</p>2018-09-25</li><br/><li><span>雪飞鸿</span> 👍（0） 💬（1）<p>每个节点都会产生一个socket连接，怎样复用这些连接呢？</p>2019-05-12</li><br/><li><span>Geek__sunchi</span> 👍（0） 💬（1）<p>看到老师的名字，立马下单了。之前看过老师的Java Web技术内幕，当时就一个感受，老师真的很厉害，讲的很清楚透彻。还有，没想到老师的声音也很好听。</p>2019-03-10</li><br/>
</ul>