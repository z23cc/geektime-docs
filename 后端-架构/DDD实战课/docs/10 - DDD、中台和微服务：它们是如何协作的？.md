你好，我是欧创新。今天我一起来聊聊DDD、中台和微服务的关系。

DDD和微服务来源于西方，而中台诞生于中国的阿里巴巴。DDD在二十多年前提出后一直默默前行，中台和微服务的理念近几年才出现，提出后就非常火爆。这三者看似风马牛不相及，实则缘分匪浅。中台是抽象出来的业务模型，微服务是业务模型的系统实现，DDD作为方法论可以同时指导中台业务建模和微服务建设，三者相辅相成，完美结合。

你可能会问：凭什么DDD可以指导中台和微服务建设，究竟起到了什么作用呢？

DDD有两把利器，那就是它的战略设计和战术设计方法。

中台在企业架构上更多偏向业务模型，形成中台的过程实际上也是业务领域不断细分的过程。在这个过程中我们会将同类通用的业务能力进行聚合和业务重构，再根据限界上下文和业务内聚的原则建立领域模型。而DDD的战略设计最擅长的就是领域建模。

那在中台完成领域建模后，我们就需要通过微服务来完成系统建设。此时，DDD的战术设计又恰好可以与微服务的设计完美结合。可以说，中台和微服务正是DDD实战的最佳场景。

## DDD的本质

我们先简单回顾一下DDD领域、子域、核心域、通用域和支撑域等概念，后面会用到。

在研究和解决业务问题时，DDD会按照一定的规则将业务领域进行细分，领域细分到一定的程度后，DDD会将问题范围限定在特定的边界内，并在这个边界内建立领域模型，进而用代码实现该领域模型，解决相应的业务问题。领域可分解为子域，子域可继续分为子子域，一直到你认为适合建立领域模型为止。

子域还会根据自身重要性和功能属性划分为三类子域，它们分别是核心域、支撑域和通用域。关于这三类子域更为详细的讲解，你可以回看[\[第02讲\]](https://time.geekbang.org/column/article/149945)。

![](https://static001.geekbang.org/resource/image/99/29/991b8a5b685d8b0b3e172f38c0460a29.png?wh=1254%2A752)

接下来我们一起看下上面这张图，我选择了保险的几个重要领域，进行了高阶的领域划分。当然每个企业的领域定位和职责会有些不一样，那在核心域的划分上肯定会有一定差异。因此，当你去做领域划分的时候，请务必结合企业战略，这恰恰也体现了DDD领域建模的重要性。

通过领域划分和进一步的子域划分，我们就可以区分不同子域在企业内的功能属性和重要性，进而采取不同的资源投入和建设策略，这在企业IT系统的建设过程中十分重要，并且这样的划分还可以帮助企业进行中台设计。

## 中台的本质

中台来源于阿里的中台战略（详见《企业IT架构转型之道：阿里巴巴中台战略思想与架构实战》钟华编著）。2015年年底，阿里巴巴集团对外宣布全面启动中台战略，构建符合数字时代的更具创新性、灵活性的“大中台、小前台”组织机制和业务机制，即作为前台的一线业务会更敏捷、更快速地适应瞬息万变的市场，而中台将集合整个集团的运营数据能力、产品技术能力，对各前台业务形成强力支撑。

中台的本质其实就是提炼各个业务板块的共同需求，进行业务和系统抽象，形成通用的可复用的业务模型，打造成组件化产品，供前台部门使用。前台要做什么业务，需要什么资源，可以直接找中台，不需要每次都去改动自己的底层。

## DDD、中台和微服务的协作模式

我们在 [\[第09讲\]](https://time.geekbang.org/column/article/159580) 已经说过了传统企业和阿里中台战略的差异，那实际上更多的企业还是会聚焦在传统企业中台建设的模式，也就是将通用能力与核心能力全部中台化，以满足不同渠道核心业务能力的复用，那么接下来我们就还是把重点放在传统企业上。

传统企业可以将需要共享的公共能力进行领域建模，建设可共享的**通用中台**。除此之外，传统企业还会将核心能力进行领域建模，建设面向不同渠道的可复用的**核心中台**。

而这里的通用中台和核心中台都属于我们上一讲讲到的业务中台的范畴。

DDD的子域分为核心域、通用域和支撑域。划分这几个子域的主要目的是为了确定战略资源的投入，一般来说战略投入的重点是核心域，因此后面我们就可以暂时不严格区分支撑域和通用域了。

领域、中台以及微服务虽然属于不同层面的东西，但我们还是可以将他们分解对照，整理出来它们之间的关系。你看下面这张图，我是从DDD领域建模和中台建设这两个不同的视角对同一个企业的业务架构进行分析。

![](https://static001.geekbang.org/resource/image/c6/df/c647561ff910f97b8500b75de70281df.png?wh=1399%2A880)

如果将企业内整个业务域作为一个问题域的话，企业内的所有业务就是一个领域。在进行领域细分时，从DDD视角来看，子域可分为核心域、通用域和支撑域。从中台建设的视角来看，业务域细分后的业务中台，可分为核心中台和通用中台。

从领域功能属性和重要性对照来看，通用中台对应DDD的通用域和支撑域，核心中台对应DDD的核心域。从领域的功能范围来看，子域与中台是一致的。领域模型所在的限界上下文对应微服务。建立了这个映射关系，我们就可以用DDD来进行中台业务建模了。

**我们这里还是以保险领域为例。**保险域的业务中台分为两类：第一类是提供保险核心业务能力的核心中台（比如营销、承保和理赔等业务）；第二类是支撑核心业务流程完成保险全流程的通用中台（比如订单、支付、客户和用户等）。

这里我要提醒你一下：根据DDD首先要建立通用语言的原则，在将DDD的方法引入中台设计时，我们要先建立中台和DDD的通用语言。这里的子域与中台是一致的，那我们就可以将子域统一为中台。

中台通过事件风暴可以进一步细分，最终完成业务领域建模。中台业务领域的功能不同，限界上下文的数量和大小就会不一样，领域模型也会不一样。

当完成业务建模后，我们就可以采用DDD战术设计，设计出聚合、实体、领域事件、领域服务以及应用服务等领域对象，再利用分层架构模型完成微服务的设计。

以上就是DDD、中台和微服务在应用过程中的协作模式。

## 中台如何建模？

看完了三者的协作模式，我们就顺着上面的话题，接着来聊聊中台如何建模。

中台业务抽象的过程就是业务建模的过程，对应DDD的战略设计。系统抽象的过程就是微服务的建设过程，对应DDD的战术设计。下面我们就结合DDD领域建模的方法，讲一下中台业务建模的过程。

**第一步：**按照业务流程（通常适用于核心域）或者功能属性、集合（通常适用于通用域或支撑域），将业务域细分为多个中台，再根据功能属性或重要性归类到核心中台或通用中台。核心中台设计时要考虑核心竞争力，通用中台要站在企业高度考虑共享和复用能力。

**第二步：**选取中台，根据用例、业务场景或用户旅程完成事件风暴，找出实体、聚合和限界上下文。依次进行领域分解，建立领域模型。

由于不同中台独立建模，某些领域对象或功能可能会重复出现在其它领域模型中，也有可能本该是同一个聚合的领域对象或功能，却分散在其它的中台里，这样会导致领域模型不完整或者业务不内聚。这里先不要着急，这一步我们只需要初步确定主领域模型就可以了，在第三步中我们还会提炼并重组这些领域对象。

**第三步：**以主领域模型为基础，扫描其它中台领域模型，检查并确定是否存在重复或者需要重组的领域对象、功能，提炼并重构主领域模型，完成最终的领域模型设计。

**第四步：**选择其它主领域模型重复第三步，直到所有主领域模型完成比对和重构。

**第五步：**基于领域模型完成微服务设计，完成系统落地。

![](https://static001.geekbang.org/resource/image/3c/47/3caae85ef680eb7cbc2ffb5c6a603f47.png?wh=1303%2A993)

结合上面这张图，你可以大致了解到DDD中台设计的过程。DDD战略设计包括上述的第一步到第四步，主要为：业务域分解为中台，对中台归类，完成领域建模，建立中台业务模型。DDD战术设计是第五步，领域模型映射为微服务，完成中台建设。

![](https://static001.geekbang.org/resource/image/45/71/45de1af6a4b5dd6cf54921ff9f422571.png?wh=1242%2A992)

那么如果还是以保险领域为例的话，完成领域建模后，里面的数据我们就可以填上了。这里我选取了通用中台的用户、客户和订单三个中台来做示例。客户中台提炼出了两个领域模型：客户信息和客户视图模型。用户中台提炼出了三个领域模型：用户管理、登录认证和权限模型。订单中台提炼出了订单模型。

这就是中台建模的全流程，当然看似简单的背后，若是遇上复杂的业务总会出现各种各样的问题，不然应用起来也不会有那么多的困难。如果你在按照以上流程实施的过程中遇到什么问题，欢迎在留言区和我讨论。

## 总结

今天我们主要讨论了传统企业中台建设的一些思路，梳理了DDD、中台和微服务的关系。DDD的战略设计可用于中台业务建模，战术设计可指导中台微服务设计。相信DDD与中台的完美结合，可以让你的中台建设如虎添翼！

另外，这一讲只是开一个头，在下一讲中我还会以一个传统核心业务的中台建设案例，详细讲解中台的设计过程。

## 思考题

你的企业是否在做中台？现在是用什么方法做中台业务建模呢？和DDD的设计方法相比，你觉得孰优孰劣？

欢迎留言分享，你也可以把今天所学分享给身边的朋友，邀请他一同交流、打卡。
<div><strong>精选留言（15）</strong></div><ul>
<li><span>肖大保健</span> 👍（24） 💬（6）<p>我们做的跨境物流下单系统，涉及到用户，商品，支付，订单一些服务，用户，商品，支付相当于通用中台，订单这一块我有点矛盾，不知该归于核心还是通用，订单有，数据流的一些扭转，其他服务都是服务于订单，订单有核心的条件，但是从另外一方面讲，用户增删查改，这些操作订单，感觉也是比较通用型的，我该如何划分出核心中台</p>2019-11-16</li><br/><li><span>钱晟龙🐲龍🐉</span> 👍（13） 💬（3）<p>用户管理+用户组织架构管理+认证&amp;鉴权，我们都做到一个微服务里面了~~， 这样看来可以拆3个出来
=。=   不过那样拆得太细的话，程序员写代码快速迭代期，项目来回切换发布，挺痛苦。
前后分离一个repository 一个前端部署,  用户sso单点登录一个api层服务 一个部署， 服务层用一个服务把三种领域包圆了。
老师怎么看这个问题，太细了会不会反而让系统变得维护时间变长。</p>2020-02-22</li><br/><li><span>hunter</span> 👍（7） 💬（3）<p>对照着图看，感觉中台和微服务没啥区别，感觉中台就是整合了通用微服务</p>2019-11-05</li><br/><li><span>若水</span> 👍（7） 💬（4）<p>老师，我想咨询一下，画领域驱动设计图一般用什么样的工具</p>2019-11-04</li><br/><li><span>阿玛铭</span> 👍（5） 💬（4）<p>欧老师好，我在搞一个DDD代码目录结构规范。大概做法：1. 列出DDD的术语表 2. 规定resources目录和包目录下的结构。3.拿一个子子域作为示例给出完整的目录结构。 这件事工作量比较小，但我觉得比较有必要，不建立可执行的规范后面代码管理必然走向混乱。还有就是我担心有一些考虑不周到的地方，这块有可以提供的一些参考吗？</p>2019-11-05</li><br/><li><span>发飙的蜗牛</span> 👍（3） 💬（2）<p>感觉讲的有点抽象，没有相关经验有些理解不了，DDD讲个人觉得要循序渐进，还没讲到如何使用DDD去落地微服务，就讲到中台微服务之间的关系这些了，跳跃有点大。</p>2020-02-24</li><br/><li><span>Kian.Lee</span> 👍（3） 💬（1）<p>中台的业务模型和 DDD 的领域模型，我个人觉得只是两种设计思想对同一事物的不同描述，两者都是应对复杂软件系统的构建方法论。</p>2019-11-04</li><br/><li><span>风</span> 👍（1） 💬（1）<p>我们现在的系统建设是按照中台的目标建设的全流程的子服务，也就是各玩各的，服务之间几乎无交互，被新的CTO说的一文不值</p>2020-11-06</li><br/><li><span>zygfengyuwuzu</span> 👍（1） 💬（1）<p>这一讲彻底搞明白了DDD，中台和微服务的关系了</p>2020-10-24</li><br/><li><span>如水</span> 👍（1） 💬（1）<p>一个领域的服务，还需要分前台与管理后台吗？</p>2020-08-29</li><br/><li><span>Geek_dn82ci</span> 👍（1） 💬（1）<p>请问老师在真实的ddd战略设计实践中，有没有和敏捷方法相结合的情况出现？我发现ddd中也会采用类似用户故事，用户旅程等工具</p>2020-02-02</li><br/><li><span>大导演</span> 👍（1） 💬（2）<p>老师您好，是否可以从多快好省四个角度，来解释中台或微服务呢，谢谢</p>2020-01-10</li><br/><li><span>Geek_zbvt62</span> 👍（1） 💬（4）<p>1.其实还是不太清楚如何区分核心域与通用域，支撑域。特别通用的就肯定不是核心域了是么？
2.上篇里一直讲中台要“联通核心业务链路”，那映射到DDD，怎么才算是“联通核心域链路”呢？</p>2019-11-05</li><br/><li><span>杨杰</span> 👍（1） 💬（1）<p>看图上把用户管理、登陆认证、权限管理分成了三个微服务，那是不是说这三个都要对应独立的数据库？</p>2019-11-05</li><br/><li><span>朱振光</span> 👍（1） 💬（1）<p>是否中台就对应一个子域？只是看问题的角度不一样，有没有例外？</p>2019-11-05</li><br/>
</ul>